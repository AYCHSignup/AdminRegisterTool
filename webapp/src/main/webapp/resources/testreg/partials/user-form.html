  <div  data-ng-include src='"resources/testreg/partials/leftnav.html"'></div>

 <div class="secContent"> 

<div data-ng-repeat="error in errors">
               <div><span class="icon_sprite icon_error error"></span>{{error}}</div>
</div>
           
<div data-ng-form="userForm" class="formWrapper">
    <div data-ng-show="userForm.$dirty" class="dirtynag">* Warning: You have unsaved changes</div>
    <div class="fieldGroup">
    <h5>{{formAction}} {{entityNameLabels['User']}} Information <span class="control-label-required">Indicates required field</span></h5>
        <ul>
             <li>
                <span> 
                    <label class="control-label-required" for="user.firstName">{{xwalk('First Name')}}:</label>
                    <input type="text" data-ng-model="user.firstName"/>
                </span>
            </li>
             <li>
                <span> 
                    <label class="control-label-required" for="user.lastName">{{xwalk('Last Name')}}:</label>
                    <input type="text" data-ng-model="user.lastName"/>
               </span>
            </li> 
             <li>
                <span> 
                    <label class="control-label-required" for="user.email">{{xwalk('Email Address')}}:</label>
                    <input type="text" data-ng-model="user.email"/>
               </span>
            </li>  
             <li>
                <span> 
                    <label class="control-label" for="user.phone">{{xwalk('Telephone Number')}}:</label>
                    <input type="text" data-ng-model="user.phone"/>
                </span>
            </li>  
        </ul>

        <div data-ng-hide="!user.changeEventExportError">
            This user was not successfully provisioned due to the following error(s):<br>
            <div class="user-error-alert">{{user.changeEventExportError}}</div>
        </div>

        <h5>Role Associations</h5>
        <div class="tableWrapper">
            <table class="assessmentTable">
                    <colgroup>
                        <col>
                        <col>
                        <col> 
                        <col>
                        <col>
                        <col class="actionColumn">
                    </colgroup>
                    <tr>
                        <th data-ng-class="{'control-label-required' : user.roleAssociations && user.roleAssociations.length > 0}">{{xwalk('Role')}}</th>
                        <th data-ng-class="{'control-label-required' : user.roleAssociations && user.roleAssociations.length > 0}">{{xwalk('Responsible Entity Type')}}</th>
                        <th data-ng-class="{'control-label' : user.roleAssociations && user.roleAssociations.length > 0}">{{xwalk('Parent Filter')}}</th>
                        <th data-ng-class="{'control-label-required' : user.roleAssociations && user.roleAssociations.length > 0}">{{xwalk('Associated Entity Id')}}</th>
                        <th>{{xwalk('State')}}</th>
                        <th>
                            <div class="tableButtonGroup">
                              <button data-ng-click="addRoleAssociation()" class="boxBtn" ><span class="btnIcon icon_sprite icon_saveAdd2"></span></button>
                            </div>
                        </th>
                    </tr>
                    <tr  data-ng-repeat="roleAssociation in user.roleAssociations">   
                        <td>
                            <div class="centerDiv">                
                                 <select data-ng-model="roleAssociation.role" data-ng-options="userRole.role as userRole.role for userRole in roles | orderBy:'role'" data-ng-change="getEntities(roleAssociation.role, $index)">
                                    <option value="">Select...</option>
                                 </select>
                            </div>
                        </td>               
                        <td>
                            <div class="centerDiv">                
                                <select  data-ng-model="roleAssociation.level" data-ng-options="entity.entity as entity.entity for entity in entities[$index]" data-ng-change="getAssociatedEntityIds(roleAssociation.level, $index)">
                                    <option value="">Select...</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <div class="centerDiv">
                                 <select  data-ng-model="selectedParentId[$index]" data-ng-options="entity.entityId as entity.entityId + ' - ' + entity.entityName + ' (' + entity.entityType + ')' for entity in parentEntityIds[$index] | orderBy:'entityId'" data-ng-change="filteredEntityIds($index,roleAssociation.level,selectedParentId[$index])">
                                    <option value="">Select...</option>
                                 </select>
                            </div>
                        </td>
                        <td>
                            <div class="centerDiv">
                                <select  data-ng-model="roleAssociation.associatedEntityId" data-ng-options="entity.entityId as entity.entityId + ' - ' + entity.entityName for entity in entityIds[$index] | orderBy:'entityId'" data-ng-change="getStateAbbreviation(entityIds[$index],roleAssociation)">
                                    <option value="">Select...</option>
                                </select>
                            </div>
                        </td>
                        <td>
                          <div class="centerDiv">                      
                                <span data-ng-show="!roleAssociation.muliFlag">{{roleAssociation.stateAbbreviation}}</span>  
                                <span data-ng-show="roleAssociation.muliFlag">
                                     <select  data-ng-model="roleAssociation.stateAbbreviation" data-ng-options="stateAbbreviation for stateAbbreviation in roleAssociation.stateAbbreviations" >
                                 </select>  
                                 </span>  
                            </div>
                        </td>                                                  
                        <td>
                            <div class="tableButtonGroup">
                                <button data-ng-click="removeRoleAssociation($index)" class="boxBtn"><span class="btnIcon icon_sprite icon_delete2"></span></button>
                            </div>
                        </td>      
                    </tr>
            </table>
       </div>
        
        <button type="button" class="boxBtn" data-ng-show="userForm.$dirty" data-ng-click="save(user)">
            <span class="btnIcon icon_sprite icon_save2 ng-class:{ajax_indicator:savingIndicator}" ></span>
            <span class="btnText">Save</span>
        </button>
     
        <button type="button" class="boxBtn" data-ng-click="cancel()">
            <span class="btnIcon icon_sprite icon_cancel2" ></span>
            <span class="btnText">Cancel</span>
        </button>

        <h5>{{entityNameLabels['User']}} Actions</h5>
        <button type="button" class="boxBtn" data-ng-click="sync()">
            <span class="btnIcon icon_sprite icon_reTry2" ></span>
            <span class="btnText">Sync</span>
        </button>

        <button type="button" class="boxBtn" data-ng-click="resetPassword()">
            <span class="btnIcon icon_sprite icon_save2" ></span>
            <span class="btnText">Reset Password</span>
        </button>

        <button type="button" class="boxBtn" data-ng-click="lock()">
            <span class="btnIcon icon_sprite icon_save2" ></span>
            <span class="btnText">Lock User</span>
        </button>

        <button type="button" class="boxBtn" data-ng-click="unlock()">
            <span class="btnIcon icon_sprite icon_save2" ></span>
            <span class="btnText">Unlock User</span>
        </button>

    </div>
</div>  

</div>  

</div>
<div class="clear"></div>
