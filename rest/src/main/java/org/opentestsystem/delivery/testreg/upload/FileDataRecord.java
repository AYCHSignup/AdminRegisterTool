/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.delivery.testreg.upload;

import java.util.Arrays;
import java.util.List;

import org.apache.commons.lang.builder.EqualsBuilder;
import org.apache.commons.lang.builder.HashCodeBuilder;
import org.apache.poi.ss.usermodel.Row;

public class FileDataRecord implements DataRecord {

    private String[] columns;

    private RowMetadata rowMetadata;
    
    public FileDataRecord(Row row, List<String> columnData) {
        this(new RowMetadataImpl(row), columnData);
    }

    public FileDataRecord(RowMetadata rowMetadata, List<String> columnData) {
        this.rowMetadata = rowMetadata;
        this.columns = columnData.toArray(new String[columnData.size()]);
    }

    public FileDataRecord(RowMetadata rowMetadata, String[] columnData) {
        this(rowMetadata, Arrays.asList(columnData));
    }
    
    public FileDataRecord(int rowNum, String[] rowData) {
        this(new RowMetadataImpl(rowNum, null), rowData);
    }
    
    public FileDataRecord(Row row, Object[] columnData) {
        this(row, Arrays.asList(columnData).toArray(new String[columnData.length]));
    }

    public FileDataRecord(Row row, String[] columnData) {
        this.rowMetadata = new RowMetadataImpl(row);
        this.columns = columnData;
    }

    public String[] getColumns() {
        return columns;
    }

    /**
     * Returns value for that column. Column numbers are zero based. Returns null when no column is found.
     * 
     * @param columnNum
     *            Column Number
     * 
     * @return Value of the column
     */
    public String getColumnAt(int columnNum) {
        String value = null;

        if (columnNum < columns.length) {
            value = getColumns()[columnNum];
        }
        return value;
    }

    public RowMetadata getRowMetadata() {
        return rowMetadata;
    }

    public int getLength() {
        return columns.length;
    }

    public int hashCode() {
        final int initialValue = 25; //Random odd number
        final int multiplier = 49; //Random Odd number
        
        return new HashCodeBuilder(initialValue, multiplier)
            .append(getColumns())
            .hashCode();
    }
    
    public boolean equals(Object inRecord) {
        if (inRecord == this) {
            return true;
        }

        if (!(inRecord instanceof DataRecord)) {
            return false;
        }

        DataRecord inDataRecord = (DataRecord) inRecord;

        return new EqualsBuilder().append(getColumns(), inDataRecord.getColumns()).isEquals();
    }    
}
