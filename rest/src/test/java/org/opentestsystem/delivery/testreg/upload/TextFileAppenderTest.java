/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/

package org.opentestsystem.delivery.testreg.upload;

import static org.hamcrest.collection.IsCollectionWithSize.hasSize;
import static org.hamcrest.core.Is.is;
import static org.junit.Assert.assertThat;

import java.io.IOException;
import java.io.InputStream;
import java.util.List;

import org.apache.commons.io.IOUtils;
import org.junit.Before;
import org.junit.Test;
import org.springframework.test.util.ReflectionTestUtils;

public class TextFileAppenderTest {
    
    FileAppender appender;
    
    @Before
    public void setup() {
        appender = new TextFileAppender();
        ReflectionTestUtils.setField(appender, "lineSeperator", System.getProperty("line.separator"));
    }
    
    @Test
    public void testSuccess() throws IOException {
        String testline = "Column1 Column2 Column3 Column4";
        InputStream appendedStream = appender.insertAtTop("DISTRICT", IOUtils.toInputStream(testline));
        List<String> lines = IOUtils.readLines(appendedStream);
        assertThat(lines, hasSize(2));
        assertThat(lines.get(0), is("DISTRICT"));
        assertThat(lines.get(1), is(testline));
    }

}
