/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/

package org.opentestsystem.delivery.testreg.upload;

import static org.hamcrest.core.Is.is;
import static org.junit.Assert.assertThat;

import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.junit.Before;
import org.junit.Test;

public class ExcelUtilsTest {

    Workbook wb;
    
    ExcelUtils excelUtils;
    
    @Before
    public void setup() {
        wb = new HSSFWorkbook();
        
        Sheet testSheet = wb.createSheet("Test");
        Row row0 = testSheet.createRow(0);
        Cell cell0 = row0.createCell(0);
        cell0.setCellValue("countries");
        
        Cell cell1 =row0.createCell(1);
        cell1.setCellValue("continent");
        
        Cell cell2 =row0.createCell(2);
        cell2.setCellType(Cell.CELL_TYPE_NUMERIC);
        cell2.setCellValue("population");
        /*
         *Missing cell3 
         */
        Cell cell4 =row0.createCell(4);
        cell4.setCellType(Cell.CELL_TYPE_STRING);
        cell4.setCellValue("1percent");
        /*
         * Missing cell 5 & 6
         */
        Cell cell7 =row0.createCell(7);
        cell7.setCellType(Cell.CELL_TYPE_STRING);
        cell7.setCellValue("economy");
        
        Cell cell8 =row0.createCell(8);
        cell8.setCellValue("HeadOfState");
        
        Cell cell9 =row0.createCell(9);
        cell9.setCellValue("YearsInOffice");
    }
    
    private Sheet getTestSheet() {
        return wb.getSheet("Test");
    }
    
    @Test
    public void testGetCellValues() {
        excelUtils = new ExcelUtils();
        Object objectArray[] =excelUtils.getCellValues(getTestSheet().getRow(0));
        assertThat(objectArray, is(new Object[]{"countries", "continent", "population", "1percent", "economy", "HeadOfState", "YearsInOffice"}));
    }
    
    @Test
    public void testGetCellTextValues() {
        excelUtils = new ExcelUtils();
        String objectArray[] =excelUtils.getCellTextValues(getTestSheet().getRow(0));
        assertThat(objectArray, is(new String[]{"countries", "continent", "population", "1percent", "economy", "HeadOfState", "YearsInOffice"}));
    }
    
    @Test
    public void testGetCellValuesWithMissingCells() {
        excelUtils = new ExcelUtils();
        Object objectArray[] =excelUtils.getCellTextValuesWithNullAsBlank(getTestSheet().getRow(0));
        assertThat(objectArray, is(new Object[]{"countries", "continent", "population", "", "1percent", "", "", "economy", "HeadOfState", "YearsInOffice"}));
    }   
}
