/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/

package org.opentestsystem.delivery.testreg.persistence;

import java.util.Iterator;
import java.util.Set;

import org.opentestsystem.delivery.testreg.domain.AnnotationHelper;
import org.opentestsystem.delivery.testreg.domain.FormatType;
import org.opentestsystem.delivery.testreg.domain.TestRegistrationBase;

/**
 * Looks for Parent entity class for a given parent type.
 * 
 */
public class ParentEntityClassFinder {

    Set<Class<? extends TestRegistrationBase>> entities;

    public ParentEntityClassFinder() throws ClassNotFoundException {
        this(null);
    }

    public ParentEntityClassFinder(String basePackageName) throws ClassNotFoundException {
        entities = AnnotationHelper.getInitialEntitySet(basePackageName);
    }

    public Class<? extends TestRegistrationBase> getParentClass(String parentType) {
        Iterator<Class<? extends TestRegistrationBase>> it = entities.iterator();
        while (it.hasNext()) {
            Class<? extends TestRegistrationBase> sb11EntityClass = it.next();
            try {
                FormatType formatType = (FormatType) sb11EntityClass.getField("FORMAT_TYPE").get(null);
                if (formatType == FormatType.valueOf(parentType)) {
                    return sb11EntityClass;
                }
            } catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException e) {
                throw new RuntimeException(e);
            }
        }
        return null;
    }
}
