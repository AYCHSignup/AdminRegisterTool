/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/

package org.opentestsystem.delivery.testreg.persistence.criteria;

import static org.hamcrest.collection.IsEmptyCollection.empty;
import static org.hamcrest.core.Is.is;
import static org.hamcrest.core.IsCollectionContaining.hasItem;
import static org.hamcrest.core.IsNot.not;
import static org.junit.Assert.assertThat;
import static org.opentestsystem.delivery.testreg.domain.AnnotationHelper.getFieldLabel;
import static org.opentestsystem.delivery.testreg.domain.AnnotationHelper.getInitialEntitySet;

import java.util.ArrayList;
import java.util.List;
import java.util.Set;

import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.delivery.testreg.domain.DistrictEntity;
import org.opentestsystem.delivery.testreg.domain.FieldLabel;
import org.opentestsystem.delivery.testreg.domain.GroupOfDistrictsEntity;
import org.opentestsystem.delivery.testreg.domain.GroupOfInstitutionsEntity;
import org.opentestsystem.delivery.testreg.domain.GroupOfStatesEntity;
import org.opentestsystem.delivery.testreg.domain.Sb11Entity;
import org.opentestsystem.delivery.testreg.domain.StateEntity;
import org.opentestsystem.delivery.testreg.domain.TestRegistrationBase;

public class AnnotationHelperTest {

    FieldLabelMock fieldLabelMock;

    @Before
    public void setup() {
        fieldLabelMock = new FieldLabelMock();
    }

    @Test
    public void testFieldLabel() {
        assertThat(getFieldLabel(fieldLabelMock, "fName"), is("First Name"));
        assertThat(getFieldLabel(fieldLabelMock, "lName"), is("Last Name"));
    }

    @Test
    public void testFieldLabelFallback() {
        assertThat(getFieldLabel(fieldLabelMock, "middleInitial"), is("middleInitial"));
    }

    @Test
    public void testGetInitialEntitySet() throws ClassNotFoundException {
        List<Class<? extends Sb11Entity>> list = new ArrayList<Class<? extends Sb11Entity>>();
        list.add(DistrictEntity.class);
        list.add(StateEntity.class);
        list.add(GroupOfDistrictsEntity.class);
        list.add(GroupOfStatesEntity.class);
        list.add(GroupOfInstitutionsEntity.class);

        Set<Class<? extends TestRegistrationBase>> set = getInitialEntitySet("org.opentestsystem.delivery.testreg.domain");

        assertThat(set, is(not(empty())));
        assertThat(set, hasItem(list.get(0)));
        assertThat(set, hasItem(list.get(1)));
        assertThat(set, hasItem(list.get(2)));
        assertThat(set, hasItem(list.get(3)));
        assertThat(set, hasItem(list.get(4)));

        assertThat(getInitialEntitySet(""), is(empty()));
    }

    private class FieldLabelMock {

        @FieldLabel("First Name")
        private String fName;

        @FieldLabel("Last Name")
        private String lName;

        @SuppressWarnings("unused")
        private String middleInitial;
    }
}
