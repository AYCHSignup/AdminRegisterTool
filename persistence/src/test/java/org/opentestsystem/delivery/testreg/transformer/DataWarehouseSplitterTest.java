/*
Educational Online Test Delivery System Copyright (c) 2013 American Institutes for Research

Distributed under the AIR Open Source License, Version 1.0 See accompanying file AIR-License-1_0.txt or at
http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 */

package org.opentestsystem.delivery.testreg.transformer;

import static org.hamcrest.CoreMatchers.notNullValue;
import static org.junit.Assert.assertThat;

import java.util.List;

import org.junit.Test;
import org.opentestsystem.delivery.testreg.integration.AbstractPersistenceEmbeddedTestDw;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.integration.Message;
import org.springframework.integration.message.GenericMessage;

import com.google.common.collect.ImmutableMap;

public class DataWarehouseSplitterTest extends AbstractPersistenceEmbeddedTestDw {

    @Autowired
    @Qualifier(value = "dataWarehouseSplitter")
    private DataWarehouseSplitter splitter;

    @SuppressWarnings("unchecked")
    @Test
    public void testSplit() {

        Message<String> sourceMessage = new GenericMessage<String>("", ImmutableMap.of("dwBatchUuid", (Object) "aaaaa",
                "fileSuffix", (Object) "bbbbb"));

        Object splitReturn = splitter.splitMessage(sourceMessage);

        assertThat(splitReturn, notNullValue());

        List<Message<?>> messages = (List<Message<?>>) splitReturn;

        assertThat(messages, org.hamcrest.Matchers.hasSize(2));

    }

}
