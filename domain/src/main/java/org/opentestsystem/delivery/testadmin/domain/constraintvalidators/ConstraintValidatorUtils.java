/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/

package org.opentestsystem.delivery.testadmin.domain.constraintvalidators;

import static org.apache.commons.lang.StringUtils.split;

import javax.validation.ConstraintValidatorContext;
import javax.validation.ConstraintValidatorContext.ConstraintViolationBuilder;
import javax.validation.ConstraintValidatorContext.ConstraintViolationBuilder.NodeBuilderCustomizableContext;

public class ConstraintValidatorUtils {
    
    private static final String NODE_SEPARATOR = ".";

    public static NodeBuilderCustomizableContext addPropertyNodes(ConstraintValidatorContext context, String node) {
        ConstraintViolationBuilder constraintViolationBuilder = context.buildConstraintViolationWithTemplate(context.getDefaultConstraintMessageTemplate());
        NodeBuilderCustomizableContext nodeBuilder = null;
        if(node.contains(NODE_SEPARATOR)) {           
            String[] nodeNames = split(node, NODE_SEPARATOR);
            for(String nodeName: nodeNames) {
                if(nodeBuilder == null) {
                    nodeBuilder =  constraintViolationBuilder
                               .addPropertyNode(nodeName);
                } else {
                    nodeBuilder = nodeBuilder.addPropertyNode(nodeName);
                }
            }
            return nodeBuilder;
        }
        throw new RuntimeException("Only NestedPaths of depth 2 can be allowed");
    }
}
